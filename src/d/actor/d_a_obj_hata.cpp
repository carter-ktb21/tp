//
// Generated By: dol2asm
// Translation Unit: d_a_obj_hata
//

#include "d/dolzel_rel.h" // IWYU pragma: keep

#include "d/actor/d_a_obj_hata.h"
#include "f_op/f_op_actor.h"

/* 80C18BB8-80C18BD8 000078 0020+00 1/1 0/0 0/0 .text daObjHata_c_createHeap__FP10fopAc_ac_c */
static int daObjHata_c_createHeap(fopAc_ac_c* a_this) {
    return static_cast<daObjHata_c*>(a_this)->createHeap();
}

/* 80C18BD8-80C18CCC 000098 00F4+00 1/1 0/0 0/0 .text            nodeCallBack__FP8J3DJointi */
static int nodeCallBack(J3DJoint* i_joint, int param_2) {
    if (param_2 != 0) {
        return 1;
    }

    int jntNo = i_joint->getJntNo();
    if (jntNo < 0 || jntNo >= 3) {
        return 1;
    }

    J3DModel* model = j3dSys.getModel();
    daObjHata_c* i_this = (daObjHata_c*)model->getUserArea();
    if (model == NULL || i_this == NULL) {
        return 1;
    }

    csXyz angle;
    i_this->getJntAngle(&angle, jntNo);
    MTXCopy(model->getAnmMtx(jntNo), mDoMtx_stack_c::get());
    mDoMtx_stack_c::ZXYrotM(angle);
    model->setAnmMtx(jntNo, mDoMtx_stack_c::get());
    mDoMtx_copy(mDoMtx_stack_c::get(), J3DSys::mCurrentMtx);

    return 1;
}

/* 80C194C8-80C194CC -00001 0004+00 3/3 0/0 0/0 .data            l_arcName */
static char* l_arcName = "Hata";

/* 80C18D08-80C18D64 0001C8 005C+00 2/2 0/0 0/0 .text            __ct__11daObjHata_cFv */
daObjHata_c::daObjHata_c() {}

/* 80C18D68-80C18E00 000228 0098+00 1/0 0/0 0/0 .text            __dt__11daObjHata_cFv */
daObjHata_c::~daObjHata_c() {
    dComIfG_resDelete(this, l_arcName);
}

/* 80C18E00-80C18E70 0002C0 0070+00 1/1 0/0 0/0 .text            createHeap__11daObjHata_cFv */
int daObjHata_c::createHeap() {
    J3DModelData* a_model_data_p = (J3DModelData*)dComIfG_getObjectRes(l_arcName, 3);
    JUT_ASSERT(109, a_model_data_p != NULL);
    model = mDoExt_J3DModel__create(a_model_data_p, 0x80000, 0x11000084);
    if (model == NULL) {
        return 0;
    }

    return 1;
}

/* 80C18E70-80C18F88 000330 0118+00 1/1 0/0 0/0 .text            create__11daObjHata_cFv */
cPhs__Step daObjHata_c::create() {
    fopAcM_ct(this, daObjHata_c);

    cPhs__Step phase_step = (cPhs__Step)dComIfG_resLoad(this, l_arcName);
    if (phase_step == cPhs_COMPLEATE_e) {
        if (!fopAcM_entrySolidHeap(this, daObjHata_c_createHeap, 0x870)) {
            return cPhs_ERROR_e;
        }

        init();
        setModelMtx();
        fopAcM_SetMtx(this, model->getBaseTRMtx());
        fopAcM_setCullSizeBox2(this, model->getModelData());

        for (int i = 0; i < 3; i++) {
            J3DJoint* jnt_node_p = model->getModelData()->getJointNodePointer(i);
            if (jnt_node_p != NULL) {
                jnt_node_p->setCallBack(nodeCallBack);
                model->setUserArea((uintptr_t)this);
            }
        }
    }

    return phase_step;
}

/* 80C18F88-80C18FBC 000448 0034+00 1/1 0/0 0/0 .text            Delete__11daObjHata_cFv */
int daObjHata_c::Delete() {
    this->~daObjHata_c();
    return 1;
}

/* 80C18FBC-80C19060 00047C 00A4+00 1/1 0/0 0/0 .text            draw__11daObjHata_cFv */
int daObjHata_c::draw() {
    g_env_light.settingTevStruct(16, &current.pos, &tevStr);
    g_env_light.setLightTevColorType_MAJI(model, &tevStr);
    dComIfGd_setListBG();
    mDoExt_modelUpdateDL(model);
    dComIfGd_setList();
    return 1;
}

/* 80C19060-80C19098 000520 0038+00 1/1 0/0 0/0 .text            execute__11daObjHata_cFv */
int daObjHata_c::execute() {
    moveSwing();
    setModelMtx();
    return 1;
}

/* 80C19098-80C190FC 000558 0064+00 2/2 0/0 0/0 .text            setModelMtx__11daObjHata_cFv */
void daObjHata_c::setModelMtx() {
    mDoMtx_stack_c::transS(current.pos.x, current.pos.y, current.pos.z);
    mDoMtx_stack_c::YrotM(shape_angle.y);
    model->setBaseTRMtx(mDoMtx_stack_c::get());
}

/* 80C190FC-80C1919C 0005BC 00A0+00 1/1 0/0 0/0 .text            init__11daObjHata_cFv */
void daObjHata_c::init() {
    for (int i = 0; i < 3; i++) {
        field_0x58c[i] = cM_rndFX(1280.0f);
        field_0x598[i] = cM_rndFX(1280.0f);
        field_0x5bc[i] = 1;
        field_0x5bf[i] = -1;
        field_0x5a4[i] = cM_rndF(1.0f);
        field_0x5b0[i] = cM_rndF(1.0f);
    }
}

/* 80C1919C-80C193BC 00065C 0220+00 1/1 0/0 0/0 .text            moveSwing__11daObjHata_cFv */
void daObjHata_c::moveSwing() {
    #undef SING
    static int const SING[3] = {
        1, -1, 1,
    };

    static int const AIM_ANGLE_X[3] = {
        0, 0x2BC, 0x2BC,
    };

    static int const STEP_ANGLE_X[3] = {
        0, 0x3C, 0x5A,
    };
    
    for (int i = 0; i < 3; i++) {
        f32 fVar1 = jnt_angle[i].x;
        f32 fVar2 = jnt_angle[i].z;
        if (cLib_chaseF(&fVar2, field_0x598[i] * (field_0x5bc[i] * SING[i]), field_0x5a4[i] * 50.0f) != 0) {
            field_0x598[i] = cM_rndF(1500.0f);

            if (i == 2) {
                field_0x5bc[i] *= -1;
                field_0x5a4[i] = cM_rndF(1.0f) + 0.1f;
            }
        }

        if (cLib_chaseF(&fVar1, field_0x58c[i] * (field_0x5bf[i] * SING[i]), field_0x5b0[i] * STEP_ANGLE_X[i]) != 0) {
            field_0x58c[i] = cM_rndF(AIM_ANGLE_X[i]);

            if (i == 2) {
                field_0x5bf[i] *= -1;
                field_0x5b0[i] = cM_rndF(1.0f) + 0.5f;
            }
        }

        jnt_angle[i].x = fVar1;
        jnt_angle[i].z = fVar2;
    }
}

/* 80C193BC-80C19410 00087C 0054+00 1/0 0/0 0/0 .text            daObjHata_create__FP11daObjHata_c */
static int daObjHata_create(daObjHata_c* i_this) {
    fopAcM_ct(i_this, daObjHata_c);
    return i_this->create();
}

/* 80C19410-80C19430 0008D0 0020+00 1/0 0/0 0/0 .text            daObjHata_Delete__FP11daObjHata_c */
static int daObjHata_Delete(daObjHata_c* i_this) {
    return i_this->Delete();
}

/* 80C19430-80C19450 0008F0 0020+00 1/0 0/0 0/0 .text            daObjHata_execute__FP11daObjHata_c */
static int daObjHata_execute(daObjHata_c* i_this) {
    return i_this->execute();
}

/* 80C19450-80C19470 000910 0020+00 1/0 0/0 0/0 .text            daObjHata_draw__FP11daObjHata_c */
static int daObjHata_draw(daObjHata_c* i_this) {
    return i_this->draw();
}

/* 80C194CC-80C194EC -00001 0020+00 1/0 0/0 0/0 .data            daObjHata_METHODS */
static actor_method_class daObjHata_METHODS = {
    (process_method_func)daObjHata_create,
    (process_method_func)daObjHata_Delete,
    (process_method_func)daObjHata_execute,
    (process_method_func)NULL,
    (process_method_func)daObjHata_draw,
};

/* 80C194EC-80C1951C -00001 0030+00 0/0 0/0 1/0 .data            g_profile_Obj_Hata */
extern actor_process_profile_definition g_profile_Obj_Hata = {
  fpcLy_CURRENT_e,        // mLayerID
  7,                      // mListID
  fpcPi_CURRENT_e,        // mListPrio
  PROC_Obj_Hata,        // mProcName
  &g_fpcLf_Method.base,  // sub_method
  sizeof(daObjHata_c),  // mSize
  0,                      // mSizeOther
  0,                      // mParameters
  &g_fopAc_Method.base,   // sub_method
  747,                    // mPriority
  &daObjHata_METHODS,   // sub_method
  0x00040180,             // mStatus
  fopAc_ENV_e,            // mActorType
  fopAc_CULLBOX_CUSTOM_e, // cullType
};
